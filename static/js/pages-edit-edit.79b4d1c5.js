(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-edit-edit"],{"0bd0":function(n,t,a){"use strict";var i=a("0ee0"),e=a.n(i);e.a},"0bff":function(n,t,a){"use strict";a.r(t);var i=a("24de"),e=a.n(i);for(var o in i)["default"].indexOf(o)<0&&function(n){a.d(t,n,(function(){return i[n]}))}(o);t["default"]=e.a},"0ee0":function(n,t,a){var i=a("65e5");i.__esModule&&(i=i.default),"string"===typeof i&&(i=[[n.i,i,""]]),i.locals&&(n.exports=i.locals);var e=a("967d").default;e("6821f7dc",i,!0,{sourceMap:!1,shadowMode:!1})},"24de":function(n,t,a){"use strict";a("6a54");var i=a("3639").default,e=a("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,a("01a2"),a("e39c"),a("5ef2"),a("c223"),a("bf0f");var o=e(a("2634")),s=e(a("2fdc")),c=e(a("9b1b")),r=i(a("9064")),d=a("8f59"),u={data:function(){return{productId:null,loading:!0,saving:!1,formData:{title:"",description:"",price:null,category:"",campus:"",condition:""},imageTempPath:"",imagePreview:"",campusOptions:["主校区","南校区","北校区"],campusIndex:0,conditionOptions:["全新","九成新","八成新","轻微瑕疵"],conditionIndex:0}},onLoad:function(n){if(!n.id)return uni.showToast({title:"无效的商品",icon:"none"}),void uni.navigateBack();this.productId=n.id,this.fetchProductData()},methods:(0,c.default)((0,c.default)({},(0,d.mapMutations)(["SET_HOME_NEEDS_REFRESH"])),{},{fetchProductData:function(){var n=this;return(0,s.default)((0,o.default)().mark((function t(){var a;return(0,o.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,r.default)({url:"/products/".concat(n.productId)});case 3:a=t.sent,n.formData.title=a.title,n.formData.description=a.description,n.formData.price=a.price,n.formData.category=a.category,n.formData.campus=a.campus||"",n.formData.condition=a.condition||"",n.campusIndex=n.campusOptions.indexOf(n.formData.campus),-1===n.campusIndex&&(n.campusIndex=0),n.conditionIndex=n.conditionOptions.indexOf(n.formData.condition),-1===n.conditionIndex&&(n.conditionIndex=0),n.imagePreview="".concat(r.BASE_URL,"/products/").concat(n.productId,"/image?t=").concat((new Date).getTime()),n.loading=!1,t.next=21;break;case 18:t.prev=18,t.t0=t["catch"](0),uni.showToast({title:"加载商品信息失败",icon:"none"});case 21:case"end":return t.stop()}}),t,null,[[0,18]])})))()},onCampusChange:function(n){this.campusIndex=n.detail.value,this.formData.campus=this.campusOptions[this.campusIndex]},onConditionChange:function(n){this.conditionIndex=n.detail.value,this.formData.condition=this.conditionOptions[this.conditionIndex]},chooseImage:function(){var n=this;uni.chooseImage({count:1,sizeType:["compressed"],sourceType:["album","camera"],success:function(t){n.imageTempPath=t.tempFilePaths[0],n.imagePreview=t.tempFilePaths[0]}})},handleCancel:function(){uni.navigateBack()},handleSave:function(){var n=this;this.saving=!0,this.formData.campus=this.campusOptions[this.campusIndex],this.formData.condition=this.conditionOptions[this.conditionIndex],this.imageTempPath?uni.uploadFile({url:"".concat(r.BASE_URL,"/products/").concat(this.productId),filePath:this.imageTempPath,name:"imageFile",method:"PUT",header:{Authorization:"Bearer ".concat(this.$store.state.token)},formData:this.formData,success:function(t){n.onSaveSuccess()},fail:function(t){n.onSaveFail(t)},complete:function(){n.saving=!1}}):(0,r.default)({url:"/products/".concat(this.productId),method:"PUT",data:this.formData}).then((function(t){n.onSaveSuccess()})).catch((function(t){n.onSaveFail(t)})).finally((function(){n.saving=!1}))},onSaveSuccess:function(){uni.showToast({title:"保存成功"}),this.SET_HOME_NEEDS_REFRESH(!0),setTimeout((function(){uni.navigateBack()}),1500)},onSaveFail:function(n){console.error(n),uni.showToast({title:"保存失败，请重试",icon:"none"})}})};t.default=u},"2a9b":function(n,t,a){"use strict";a.r(t);var i=a("93de"),e=a("0bff");for(var o in e)["default"].indexOf(o)<0&&function(n){a.d(t,n,(function(){return e[n]}))}(o);a("0bd0");var s=a("828b"),c=Object(s["a"])(e["default"],i["b"],i["c"],!1,null,"0ad1e073",null,!1,i["a"],void 0);t["default"]=c.exports},"65e5":function(n,t,a){var i=a("c86c");t=i(!1),t.push([n.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/* 表单样式 */.container[data-v-0ad1e073]{padding:%?20?%}.form-card[data-v-0ad1e073]{background:#fff;padding:%?30?%;border-radius:%?10?%}.form-group[data-v-0ad1e073]{margin-bottom:%?30?%}.form-label[data-v-0ad1e073]{font-size:%?30?%;color:#007aff; /* 醒目的蓝色 */margin-bottom:%?10?%;display:block}.form-input[data-v-0ad1e073]{border:1px solid #eee;padding:%?15?%;border-radius:%?5?%}.form-textarea-description[data-v-0ad1e073]{border:1px solid #eee;padding:%?15?%;width:auto; /* uni-app 会自动处理宽度 */height:%?200?%;border-radius:%?5?%}\n/* 图片上传区域样式 */.image-uploader[data-v-0ad1e073]{margin-top:%?10?%}.upload-btn[data-v-0ad1e073]{width:%?200?%;height:%?200?%;position:relative;border:2px dashed #ccc;border-radius:%?10?%;overflow:hidden /* 确保子元素不超出圆角 */}.image-preview[data-v-0ad1e073]{width:100%;height:100%}.re-upload-text[data-v-0ad1e073]{position:absolute;bottom:0;width:100%;background-color:rgba(0,0,0,.4);color:#fff;text-align:center;padding:%?5?% 0;font-size:%?24?%}\n/* 按钮组样式 */.button-group[data-v-0ad1e073]{display:flex;margin-top:%?40?%}.cancel-btn[data-v-0ad1e073]{flex:1;margin-right:%?10?%;background-color:#f0f0f0}.submit-btn[data-v-0ad1e073]{flex:1;margin-left:%?10?%;background-color:#007aff;color:#fff}",""]),n.exports=t},"93de":function(n,t,a){"use strict";a.d(t,"b",(function(){return i})),a.d(t,"c",(function(){return e})),a.d(t,"a",(function(){}));var i=function(){var n=this,t=n.$createElement,a=n._self._c||t;return n.loading?n._e():a("v-uni-view",{staticClass:"container"},[a("v-uni-view",{staticClass:"form-card"},[a("v-uni-view",{staticClass:"form-group"},[a("v-uni-text",{staticClass:"form-label"},[n._v("商品名称")]),a("v-uni-input",{staticClass:"form-input",attrs:{placeholder:"请输入商品标题"},model:{value:n.formData.title,callback:function(t){n.$set(n.formData,"title",t)},expression:"formData.title"}})],1),a("v-uni-view",{staticClass:"form-group"},[a("v-uni-text",{staticClass:"form-label"},[n._v("商品描述")]),a("v-uni-textarea",{staticClass:"form-textarea-description",attrs:{placeholder:"请输入商品描述..."},model:{value:n.formData.description,callback:function(t){n.$set(n.formData,"description",t)},expression:"formData.description"}})],1),a("v-uni-view",{staticClass:"form-group"},[a("v-uni-text",{staticClass:"form-label"},[n._v("价格")]),a("v-uni-input",{staticClass:"form-input",attrs:{type:"number",placeholder:"请输入价格"},model:{value:n.formData.price,callback:function(t){n.$set(n.formData,"price",t)},expression:"formData.price"}})],1),a("v-uni-view",{staticClass:"form-group"},[a("v-uni-text",{staticClass:"form-label"},[n._v("分类")]),a("v-uni-input",{staticClass:"form-input",attrs:{placeholder:"如: 图书、电子产品"},model:{value:n.formData.category,callback:function(t){n.$set(n.formData,"category",t)},expression:"formData.category"}})],1),a("v-uni-view",{staticClass:"form-group"},[a("v-uni-text",{staticClass:"form-label"},[n._v("校区")]),a("v-uni-picker",{attrs:{value:n.campusIndex,range:n.campusOptions},on:{change:function(t){arguments[0]=t=n.$handleEvent(t),n.onCampusChange.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"form-input"},[n._v(n._s(n.campusOptions[n.campusIndex]))])],1)],1),a("v-uni-view",{staticClass:"form-group"},[a("v-uni-text",{staticClass:"form-label"},[n._v("新旧程度")]),a("v-uni-picker",{attrs:{value:n.conditionIndex,range:n.conditionOptions},on:{change:function(t){arguments[0]=t=n.$handleEvent(t),n.onConditionChange.apply(void 0,arguments)}}},[a("v-uni-view",{staticClass:"form-input"},[n._v(n._s(n.conditionOptions[n.conditionIndex]))])],1)],1),a("v-uni-view",{staticClass:"form-group"},[a("v-uni-text",{staticClass:"form-label"},[n._v("商品图片")]),a("v-uni-view",{staticClass:"image-uploader"},[a("v-uni-view",{staticClass:"upload-btn",on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.chooseImage.apply(void 0,arguments)}}},[a("v-uni-image",{staticClass:"image-preview",attrs:{src:n.imagePreview,mode:"aspectFill"}}),a("v-uni-view",{staticClass:"re-upload-text"},[n._v("点击更换图片")])],1)],1)],1),a("v-uni-view",{staticClass:"button-group"},[a("v-uni-button",{staticClass:"cancel-btn",on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.handleCancel.apply(void 0,arguments)}}},[n._v("取消")]),a("v-uni-button",{staticClass:"submit-btn",attrs:{disabled:n.saving},on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.handleSave.apply(void 0,arguments)}}},[n._v(n._s(n.saving?"保存中...":"保存"))])],1)],1)],1)},e=[]}}]);