(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-detail-detail"],{"0315":function(n,t,e){"use strict";var a=e("40f1"),o=e.n(a);o.a},"07d9":function(n,t,e){var a=e("c86c");t=a(!1),t.push([n.i,"\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n/* 样式 */.product-image-detail[data-v-fcf233da]{width:100%}.product-card[data-v-fcf233da]{background:#fff;padding:%?20?%;margin-top:%?-10?%}.price[data-v-fcf233da]{color:red;font-size:%?40?%;font-weight:700}.title[data-v-fcf233da]{font-size:%?32?%;display:block;margin:%?10?% 0}.favorite-btn[data-v-fcf233da]{margin-top:%?20?%}.comments-section[data-v-fcf233da]{background:#fff;margin-top:%?20?%;padding:%?20?%}.section-title[data-v-fcf233da]{font-weight:700;display:block;margin-bottom:%?20?%}.comment-item[data-v-fcf233da]{border-bottom:1px solid #eee;padding:%?10?% 0}.comment-user[data-v-fcf233da]{font-weight:700;margin-right:%?10?%}.comment-form[data-v-fcf233da]{display:flex;margin-top:%?20?%}.price-status[data-v-fcf233da]{display:flex;justify-content:space-between;align-items:center}.status-badge[data-v-fcf233da]{padding:%?5?% %?15?%;border-radius:%?20?%;color:#fff;font-size:%?24?%}.selling[data-v-fcf233da]{background-color:#28a745}.sold[data-v-fcf233da]{background-color:#dc3545}.sold-btn[data-v-fcf233da]{margin-top:%?20?%;background-color:#ffc107;color:#333}",""]),n.exports=t},"07ed":function(n,t,e){"use strict";e.r(t);var a=e("76e6"),o=e("d626");for(var r in o)["default"].indexOf(r)<0&&function(n){e.d(t,n,(function(){return o[n]}))}(r);e("0315");var c=e("828b"),i=Object(c["a"])(o["default"],a["b"],a["c"],!1,null,"fcf233da",null,!1,a["a"],void 0);t["default"]=i.exports},"40f1":function(n,t,e){var a=e("07d9");a.__esModule&&(a=a.default),"string"===typeof a&&(a=[[n.i,a,""]]),a.locals&&(n.exports=a.locals);var o=e("967d").default;o("23e71310",a,!0,{sourceMap:!1,shadowMode:!1})},"76e6":function(n,t,e){"use strict";e.d(t,"b",(function(){return a})),e.d(t,"c",(function(){return o})),e.d(t,"a",(function(){}));var a=function(){var n=this,t=n.$createElement,e=n._self._c||t;return n.product?e("v-uni-view",{staticClass:"container"},[e("v-uni-image",{staticClass:"product-image-detail",attrs:{src:n.getProductImageUrl(n.productId),mode:"widthFix"}}),e("v-uni-view",{staticClass:"product-card"},[e("v-uni-view",{staticClass:"price-status"},[e("v-uni-text",{staticClass:"price"},[n._v("¥"+n._s(n.product.price))]),e("v-uni-text",{class:["status-badge","sold"===n.product.status?"sold":"selling"]},[n._v(n._s("sold"===n.product.status?"已售出":"售卖中"))])],1),e("v-uni-text",{staticClass:"title"},[n._v(n._s(n.product.title))]),e("v-uni-text",{staticClass:"description"},[n._v(n._s(n.product.description))]),e("v-uni-view",{staticClass:"owner-info"},[e("v-uni-text",[n._v("发布者: "+n._s(n.product.owner.nickname))])],1),"selling"===n.product.status?e("v-uni-button",{staticClass:"favorite-btn",on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.favoriteProduct.apply(void 0,arguments)}}},[n._v(n._s(n.isFavorited?"取消收藏":"收藏"))]):n._e(),n.isOwner&&"selling"===n.product.status?e("v-uni-button",{staticClass:"sold-btn",on:{click:function(t){arguments[0]=t=n.$handleEvent(t),n.markAsSold.apply(void 0,arguments)}}},[n._v("标记为已售出 (下架)")]):n._e()],1)],1):n._e()},o=[]},d626:function(n,t,e){"use strict";e.r(t);var a=e("fc7d"),o=e.n(a);for(var r in a)["default"].indexOf(r)<0&&function(n){e.d(t,n,(function(){return a[n]}))}(r);t["default"]=o.a},fc7d:function(n,t,e){"use strict";e("6a54");var a=e("3639").default,o=e("f5bd").default;Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,e("4626"),e("5ac7"),e("c223");var r=o(e("2634")),c=o(e("2fdc")),i=o(e("9b1b")),u=a(e("9064")),s=e("8f59"),d={data:function(){return{productId:null,product:null,commentContent:""}},computed:(0,i.default)((0,i.default)({},(0,s.mapState)(["userInfo"])),{},{isFavorited:function(){return!(!this.product||!this.userInfo)&&this.product.favoritedBy.includes(this.userInfo.id)},isOwner:function(){return this.product&&this.userInfo&&this.product.owner._id===this.userInfo.id}}),onLoad:function(n){this.productId=n.id,this.fetchProductDetail(),this.incrementViewCount()},methods:(0,i.default)((0,i.default)({},(0,s.mapMutations)(["SET_HOME_NEEDS_REFRESH"])),{},{fetchProductDetail:function(){var n=this;return(0,c.default)((0,r.default)().mark((function t(){var e;return(0,r.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,(0,u.default)({url:"/products/".concat(n.productId),method:"GET"});case 3:e=t.sent,n.product=e,t.next=10;break;case 7:t.prev=7,t.t0=t["catch"](0),uni.showToast({title:"加载失败",icon:"none"});case 10:case"end":return t.stop()}}),t,null,[[0,7]])})))()},addComment:function(){var n=this;return(0,c.default)((0,r.default)().mark((function t(){return(0,r.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n.$store.state.token){t.next=3;break}return uni.showToast({title:"请先登录",icon:"none"}),t.abrupt("return");case 3:if(n.commentContent){t.next=6;break}return uni.showToast({title:"留言不能为空",icon:"none"}),t.abrupt("return");case 6:return t.prev=6,t.next=9,(0,u.default)({url:"/products/".concat(n.productId,"/comments"),method:"POST",data:{content:n.commentContent}});case 9:n.commentContent="",uni.showToast({title:"留言成功"}),n.fetchProductDetail(),t.next=17;break;case 14:t.prev=14,t.t0=t["catch"](6),uni.showToast({title:"留言失败",icon:"none"});case 17:case"end":return t.stop()}}),t,null,[[6,14]])})))()},favoriteProduct:function(){var n=this;return(0,c.default)((0,r.default)().mark((function t(){return(0,r.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n.$store.state.token){t.next=3;break}return uni.showToast({title:"请先登录",icon:"none"}),t.abrupt("return");case 3:return t.prev=3,t.next=6,(0,u.default)({url:"/products/".concat(n.productId,"/favorite"),method:"POST"});case 6:n.fetchProductDetail(),t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](3),uni.showToast({title:"操作失败",icon:"none"});case 12:case"end":return t.stop()}}),t,null,[[3,9]])})))()},markAsSold:function(){var n=this;return(0,c.default)((0,r.default)().mark((function t(){return(0,r.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:uni.showModal({title:"确认",content:"确定要下架此商品吗？此操作不可逆。",success:function(){var t=(0,c.default)((0,r.default)().mark((function t(e){return(0,r.default)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!e.confirm){t.next=12;break}return t.prev=1,t.next=4,(0,u.default)({url:"/products/".concat(n.productId,"/status"),method:"PUT",data:{status:"sold"}});case 4:uni.showToast({title:"下架成功"}),n.SET_HOME_NEEDS_REFRESH(!0),n.fetchProductDetail(),t.next=12;break;case 9:t.prev=9,t.t0=t["catch"](1),uni.showToast({title:"操作失败",icon:"none"});case 12:case"end":return t.stop()}}),t,null,[[1,9]])})));return function(n){return t.apply(this,arguments)}}()});case 1:case"end":return t.stop()}}),t)})))()},getProductImageUrl:function(n){return"".concat(u.BASE_URL,"/products/").concat(n,"/image")},incrementViewCount:function(){this.$store.state.token&&(0,u.default)({url:"/products/".concat(this.productId,"/view"),method:"PUT"}).catch((function(n){console.error("增加浏览数量失败",n)}))}})};t.default=d}}]);